<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <!-- This migration is based off db_structure.sql -->

    <changeSet id="0.Users" author="cstroe">
        <createTable tableName="Users">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="about" type="varchar(500)"/>
            <column name="birthDate" type="datetime"/>
            <column name="confirmedEmail" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="email" type="varchar(100)"/>
            <column name="forgotPasswordToken" type="varchar(255)"/>
            <column name="isBanned" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="isSubscribed" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="karma" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="varchar(100)"/>
            <column name="markedAbout" type="varchar(600)"/>
            <column name="moderator" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(100)"/>
            <column name="nameLastTouchedAt" type="datetime"/>
            <column name="photoUri" type="varchar(255)"/>
            <column name="realName" type="varchar(100)"/>
            <column name="sluggedName" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="website" type="varchar(200)"/>
        </createTable>
    </changeSet>

    <changeSet id="0.Question" author="cstroe">
        <createTable tableName="Question">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="answerCount" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="lastUpdatedAt" type="datetime"/>
            <column name="invisible" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="views" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="voteCount" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="bigint">
                <constraints foreignKeyName="FK_a3dib35x299yvhfk7pau0kw5w"/>
            </column>
            <column name="information_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_i2xt9jcwfauudnswun94neqyg"/>
            </column>
            <column name="lastTouchedBy_id" type="bigint">
                <constraints foreignKeyName="FK_9d3cyy648wfruj9t7556wqgjr"/>
            </column>
            <column name="solution_id" type="bigint">
                <constraints foreignKeyName="FK_liw3djybv5je7ra806bsipg68"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0.QuestionInformation" author="cstroe">
        <createTable tableName="QuestionInformation">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="comment" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="ip" type="varchar(255)"/>
            <column name="markedDescription" type="text"/>
            <column name="moderatedAt" type="datetime"/>
            <column name="sluggedTitle" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(255)"/>
            <column name="title" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_9nfk2kchvyn69e7gdh798gf"/>
            </column>
            <column name="moderatedBy_id" type="bigint">
                <constraints foreignKeyName="FK_t1oox0xh74vlikcvhxd5k2kq1"/>
            </column>
            <column name="question_id" type="bigint">
                <constraints foreignKeyName="FK_pl1drgbxhfd4hbmd3smwa3svl"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet id="0.Answer" author="cstroe">
        <createTable tableName="Answer">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="lastUpdatedAt" type="datetime"/>
            <column name="invisible" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="voteCount" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="bigint">
                <constraints foreignKeyName="FK_3q5s4b88xp78n3c49dtxfs97e"/>
            </column>
            <column name="information_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_dshhxt02iww0fxkl2li8l3ao2"/>
            </column>
            <column name="lastTouchedBy_id" type="bigint">
                <constraints foreignKeyName="FK_drifk8pp2s7wsh57nvwna9m1g"/>
            </column>
            <column name="question_id" type="bigint">
                <constraints foreignKeyName="FK_10g8xii7lw9kq0kcsobgmtw72"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet id="0.AnswerInformation" author="cstroe">
        <createTable tableName="AnswerInformation">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="comment" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="ip" type="varchar(255)"/>
            <column name="markedDescription" type="text"/>
            <column name="moderatedAt" type="datetime"/>
            <column name="status" type="varchar(255)"/>
            <column name="answer_id" type="bigint">
                <constraints foreignKeyName="FK_lecgqmqj00d06wb8nwaq60rpr"/>
            </column>
            <column name="author_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_237rcoro0n05xyxjga1ip7pd8"/>
            </column>
            <column name="moderatedBy_id" type="bigint">
                <constraints foreignKeyName="FK_dbuximcggdn5k2j9svvpwtxrm"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0.Constraints" author="cstroe">
        <addForeignKeyConstraint
                baseTableName="Question"
                baseColumnNames="lastTouchedBy_id"
                constraintName="FK_9d3cyy648wfruj9t7556wqgjr"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Question"
                baseColumnNames="author_id"
                constraintName="FK_a3dib35x299yvhfk7pau0kw5w"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Question"
                baseColumnNames="information_id"
                constraintName="FK_i2xt9jcwfauudnswun94neqyg"
                referencedTableName="QuestionInformation"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Question"
                baseColumnNames="solution_id"
                constraintName="FK_liw3djybv5je7ra806bsipg68"
                referencedTableName="Answer"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="QuestionInformation"
                baseColumnNames="author_id"
                constraintName="FK_9nfk2kchvyn69e7gdh798gf"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="QuestionInformation"
                baseColumnNames="question_id"
                constraintName="FK_pl1drgbxhfd4hbmd3smwa3svl"
                referencedTableName="Question"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="QuestionInformation"
                baseColumnNames="moderatedBy_id"
                constraintName="FK_t1oox0xh74vlikcvhxd5k2kq1"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Answer"
                baseColumnNames="question_id"
                constraintName="FK_10g8xii7lw9kq0kcsobgmtw72"
                referencedTableName="Question"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Answer"
                baseColumnNames="author_id"
                constraintName="FK_3q5s4b88xp78n3c49dtxfs97e"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Answer"
                baseColumnNames="lastTouchedBy_id"
                constraintName="FK_drifk8pp2s7wsh57nvwna9m1g"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="Answer"
                baseColumnNames="information_id"
                constraintName="FK_dshhxt02iww0fxkl2li8l3ao2"
                referencedTableName="AnswerInformation"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="AnswerInformation"
                baseColumnNames="author_id"
                constraintName="FK_237rcoro0n05xyxjga1ip7pd8"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="AnswerInformation"
                baseColumnNames="moderatedBy_id"
                constraintName="FK_dbuximcggdn5k2j9svvpwtxrm"
                referencedTableName="Users"
                referencedColumnNames="id"/>

        <addForeignKeyConstraint
                baseTableName="AnswerInformation"
                baseColumnNames="answer_id"
                constraintName="FK_lecgqmqj00d06wb8nwaq60rpr"
                referencedTableName="Answer"
                referencedColumnNames="id"/>

    </changeSet>

    <changeSet id="0.Tag" author="cstroe">
        <createTable tableName="Tag">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="description" type="varchar(255)"/>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" uniqueConstraintName="UK_24642shpebunaq3ggshotv9hk"/>
            </column>
            <column name="usageCount" type="bigint"/>
            <column name="author_id" type="bigint">
                <constraints foreignKeyName="FK_9a9b8a968n0ejs6yikpgo563r"/>
            </column>
        </createTable>

        <addUniqueConstraint
                tableName="Tag"
                columnNames="name"
                constraintName="UK_24642shpebunaq3ggshotv9hk"/>

        <addForeignKeyConstraint
                baseTableName="Tag"
                baseColumnNames="author_id"
                constraintName="FK_9a9b8a968n0ejs6yikpgo563r"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.LoginMethod" author="cstroe">
        <createTable tableName="LoginMethod">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="serviceEmail" type="varchar(100)"/>
            <column name="token" type="varchar(255)"/>
            <column name="type" type="varchar(255)"/>
            <column name="user_id" type="bigint">
                <constraints foreignKeyName="FK_l0vhdtw8ymw1rrxq9usrqjh4x"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                constraintName="FK_l0vhdtw8ymw1rrxq9usrqjh4x"
                baseTableName="LoginMethod"
                baseColumnNames="user_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Watchers" author="cstroe">
        <createTable tableName="Watcher">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="active" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="watcher_id" type="bigint">
                <constraints foreignKeyName="FK_hobtys3mefri57vry8w6o8xyq"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                constraintName="FK_hobtys3mefri57vry8w6o8xyq"
                baseTableName="Watcher"
                baseColumnNames="watcher_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Vote" author="cstroe">
        <createTable tableName="Vote">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="lastUpdatedAt" type="datetime"/>
            <column name="type" type="varchar(255)"/>
            <column name="author_id" type="bigint">
                <constraints foreignKeyName="FK_6nch3y92lphrbsh0o5c7o0jov"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                constraintName="FK_6nch3y92lphrbsh0o5c7o0jov"
                baseTableName="Vote"
                baseColumnNames="author_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Flag" author="cstroe">
        <createTable tableName="Flag">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="reason" type="text"/>
            <column name="type" type="varchar(255)"/>
            <column name="author_id" type="bigint">
                <constraints foreignKeyName="FK_lumgu8dnorkynxw1l039ovm8q"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                constraintName="FK_lumgu8dnorkynxw1l039ovm8q"
                baseTableName="Flag"
                baseColumnNames="author_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.ReputationEvent" author="cstroe">
        <createTable tableName="ReputationEvent">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="context_type" type="varchar(255)"/>
            <column name="context_id" type="bigint"/>
            <column name="date" type="datetime"/>
            <column name="karmaReward" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="varchar(255)"/>
            <column name="user_id" type="bigint">
                <constraints foreignKeyName="FK_gbu6jo147pal18b3q3blpr0of"/>
            </column>
        </createTable>


        <addForeignKeyConstraint
                constraintName="FK_gbu6jo147pal18b3q3blpr0of"
                baseTableName="ReputationEvent"
                baseColumnNames="user_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Comment" author="cstroe">
        <createTable tableName="Comment">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="comment" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="createdAt" type="datetime"/>
            <column name="htmlComment" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="lastUpdatedAt" type="datetime"/>
            <column name="invisible" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="voteCount" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="author_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_j94pith5sd971k29j6ysxuk7"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                constraintName="FK_j94pith5sd971k29j6ysxuk7"
                baseTableName="Comment"
                baseColumnNames="author_id"
                referencedTableName="Users"
                referencedColumnNames="id" />
    </changeSet>
    
    <changeSet id="0.Answer_Flags" author="cstroe">
        <createTable tableName="Answer_Flags">
            <column name="Answer_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_6lq2gt46y9974igmh0jxo666"/>
            </column>
            <column name="flags_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_9y4wu81bq6tdthk881o8twros"/>
            </column>
        </createTable>

        <addUniqueConstraint tableName="Answer_Flags" columnNames="flags_id" constraintName="UK_9y4wu81bq6tdthk881o8twros"/>

        <addForeignKeyConstraint
                constraintName="FK_6lq2gt46y9974igmh0jxo666"
                baseTableName="Answer_Flags"
                baseColumnNames="Answer_id"
                referencedTableName="Answer"
                referencedColumnNames="id" />

        <addForeignKeyConstraint
                constraintName="FK_9y4wu81bq6tdthk881o8twros"
                baseTableName="Answer_Flags"
                baseColumnNames="flags_id"
                referencedTableName="Flag"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Answer_Comments" author="cstroe">
        <createTable tableName="Answer_Comments">
            <column name="Answer_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_5c40gkw8p92hpuy5nnothdhw5"/>
            </column>
            <column name="comments_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_731ugn0r28nit0o73yytcw5oh"/>
            </column>
        </createTable>

        <addUniqueConstraint
                tableName="Answer_Comments"
                columnNames="comments_id"
                constraintName="UK_731ugn0r28nit0o73yytcw5oh"/>

        <addForeignKeyConstraint
                constraintName="FK_5c40gkw8p92hpuy5nnothdhw5"
                baseTableName="Answer_Comments"
                baseColumnNames="Answer_id"
                referencedTableName="Answer"
                referencedColumnNames="id" />

        <addForeignKeyConstraint
                constraintName="FK_731ugn0r28nit0o73yytcw5oh"
                baseTableName="Answer_Comments"
                baseColumnNames="comments_id"
                referencedTableName="Comment"
                referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0.Answer_Votes" author="cstroe">
        <createTable tableName="Answer_Votes">
            <column name="Answer_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_qpawvfihxtc49opw1q5le336l"/>
            </column>
            <column name="votes_id" type="bigint">
                <constraints nullable="false" foreignKeyName="FK_5ya5d072g3h38tvb9brj7bs8o"/>
            </column>
        </createTable>

        <addUniqueConstraint
                tableName="Answer_Votes"
                columnNames="votes_id"
                constraintName="UK_5ya5d072g3h38tvb9brj7bs8o" />

        <addForeignKeyConstraint
                constraintName="FK_5ya5d072g3h38tvb9brj7bs8o"
                baseTableName="Answer_Votes"
                baseColumnNames="votes_id"
                referencedTableName="Vote"
                referencedColumnNames="id" />

        <addForeignKeyConstraint
                constraintName="FK_qpawvfihxtc49opw1q5le336l"
                baseTableName="Answer_Votes"
                baseColumnNames="Answer_id"
                referencedTableName="Answer"
                referencedColumnNames="id" />
    </changeSet>
</databaseChangeLog>